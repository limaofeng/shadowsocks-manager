steps:
  - name: "gcr.io/cloud-builders/npm"
    args: ["install"]
  - name: "gcr.io/cloud-builders/npm"
    args: ["run", "build"]
  - name: "gcr.io/cloud-builders/docker"
    args:
      [ "build", "-t ${_USERNAME}/${_REPO_NAME}", "." ]
  - name: "gcr.io/cloud-builders/docker"
    entrypoint: "bash"
    args: ["-c", "docker login --username=${_USERNAME} --password=$$PASSWORD"]
    secretEnv: ["PASSWORD"]
  - name: "gcr.io/cloud-builders/docker"
    args: ["push", "${_USERNAME}/${_REPO_NAME}"]
images:
  - "${_USERNAME}/${_REPO_NAME}"
secrets:
  - kmsKeyName: projects/gothic-depth-219813/locations/global/keyRings/keyrings-registry/cryptoKeys/key-registry
    secretEnv:
      PASSWORD: CiQAnu4BO652K9j8pPr4slt85qEDUQDwTV7/+aJzpszQWiw9kIkSNAAlH5Y8ha+J4utLt2c2rKL0kC5sjJzsQAmtBgYDUqKOwW+dYMdBvIrM4klXa96qf0WAiuY=
substitutions:
  _USERNAME: limaofeng
  _REPO_NAME: ssmgr
